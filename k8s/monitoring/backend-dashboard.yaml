apiVersion: v1
kind: ConfigMap
metadata:
  name: backend-api-dashboard
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  backend-api.json: |-
    {
      "dashboard": {
        "id": null,
        "uid": "backend-api-metrics",
        "title": "Backend API Performance",
        "tags": ["backend", "api", "performance"],
        "timezone": "browser",
        "panels": [
          {
            "title": "Request Rate",
            "type": "graph",
            "targets": [{
              "expr": "rate(http_requests_total{service=\"backend\"}[5m])",
              "legendFormat": "{{method}} {{endpoint}}"
            }]
          },
          {
            "title": "API Latency (95th percentile)",
            "type": "graph",
            "targets": [{
              "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{service=\"backend\"}[5m]))",
              "legendFormat": "{{method}} {{endpoint}}"
            }]
          },
          {
            "title": "Error Rate",
            "type": "stat",
            "targets": [{
              "expr": "rate(http_requests_total{service=\"backend\", status=~\"5..\"}[5m]) / rate(http_requests_total{service=\"backend\"}[5m]) * 100",
              "legendFormat": "Error %"
            }]
          },
          {
            "title": "Pod CPU Usage",
            "type": "gauge",
            "targets": [{
              "expr": "sum(rate(container_cpu_usage_seconds_total{container=\"backend\"}[5m]))",
              "legendFormat": "CPU Usage"
            }]
          },
          {
            "title": "Pod Memory Usage",
            "type": "gauge",
            "targets": [{
              "expr": "container_memory_working_set_bytes{container=\"backend\"} / 1024 / 1024",
              "legendFormat": "{{pod}}"
            }]
          },
          {
            "title": "Active Database Connections",
            "type": "graph",
            "targets": [{
              "expr": "mongodb_connections_current",
              "legendFormat": "Connections"
            }]
          }
        ],
        "refresh": "10s"
      }
    }